
/**
 * jQuery-plugin-layer v0.3
 * author: 贤心
 * date: 2012-3-18
 * blog: http://xu.sentsin.com/
 * 相关交流群：176047036 （web前端开发-js面向对象）
 * (c) Sentsin Xu
 
 ***********************************

具体使用说明请详见：http://xu.sentsin.com/jquery/layer/
 */ 

(function(e){var a=function(){var j=document.scripts||e("script");var h;for(var g=j.length;g>0;g--){if(j[g-1].src.indexOf("layer.js")>-1||j[g-1].src.indexOf("layer.min.js")>-1){h=j[g-1].src.substring(0,j[g-1].src.lastIndexOf("/")+1)}}return h};if(e("html").html().indexOf("png.js")==-1){ie6PNG='<script type="text/javascript" src="'+a()+'skin/png.js"><\/script>'}else{ie6PNG=""}var b="<!--[if IE 6]>"+ie6PNG+"<![endif]-->";e("title").after('\n<link rel="stylesheet" type="text/css" href="'+a()+'skin/layer.css"  />');e("head").after(b);var d=!-[1,]&&!window.XMLHttpRequest;e.layer=function(z){z=e.extend({v_skin:0,v_shade:true,v_title:"信息",v_istitle:true,v_box:0,v_btns:1,v_btn:["确定","取消"],v_offset:["200px","50%"],v_area:["310px","200px"],v_showclose:true,v_closetype:0,v_msgtype:0,v_msg:"",v_src:"http://xu.sentsin.com",v_move:true,v_showtime:0,v_dom:"#xulayer"},z);if(z.v_closebtn==false){z.v_showclose=z.v_closebtn}if(z.v_button){z.v_btns=z.v_button}if(z.v_button1){z.v_btn[0]=z.v_button1}if(z.v_button2){z.v_btn[1]=z.v_button2}if(z.v_top!=null){z.v_offset[0]=z.v_top+"px"}if(z.v_width!=null){z.v_area[0]=z.v_width+"px"}if(z.v_height!=null){z.v_area[1]=z.v_height+"px"}if(z.v_boxdom){z.v_dom=z.v_boxdom}if(z.v_btn[0]==""){z.v_btn[0]="确认"}if(z.v_btn[1]==""){z.v_btn[1]="取消"}var t=new Array('<span class="xubox_msg xubox_msgtype'+z.v_msgtype+'"></span><span class="xubox_text">'+z.v_msg+"</span>",'<div class="xubox_page xubox_page_'+z.v_skin+'"></div>','<iframe name="xubox_iframe" class="xubox_iframe" frameborder="0" src="'+z.v_src+'"></iframe>','<span class="xubox_loading xubox_loading_'+z.v_skin+'"></span>');var s={i:e(".xubox_layer").length,j:e("#xubox_shade").length};var D="";if(z.v_shade==true&&s.j<1){D='<div id="xubox_shade" class="xubox_shade_'+z.v_skin+'"></div>'}if(z.v_area[0].indexOf("px")!=-1){var g=(parseInt(z.v_area[0])/2)}else{var g=parseInt(z.v_area[0])/200*e(window).width()}if(z.v_box==3){z.v_btns=0;if(z.v_title=="信息"){z.v_title="加载中"}}var o='<div class="xubox_layer xubox_layer_'+z.v_skin+'"><div class="xubox_main xubox_main_'+z.v_skin+'">'+t[z.v_box]+'<h2 class="xubox_title xubox_title_'+z.v_skin+'"><i></i><em>'+z.v_title+'</em></h2><a class="xubox_close xubox_close'+z.v_closetype+"_"+z.v_skin+'" href="javascript:;"></a><span class="xubox_botton"></span></div></div>';if(z.v_box==0){if(e(".xubox_text").length<1){if(e(".xubox_loading").length>0){layer_close()}if(s.i>0){e("body").append(o)}else{e("body").append(D+o)}}}else{if(s.i==0){e.layer({v_title:"插件警告",v_msg:"layer在输出时发现不应该的程序错误，请检查! "})}c=0;layer_close();e("body").append(D);if(z.v_box==1){e(z.v_dom).show().wrap(o)}else{e("body").append(o)}}e(".xubox_layer").each(function(E){$xuboxlayer=e(this)});var r=$xuboxlayer.index(".xubox_layer");var u=e(".xubox_layer").eq(r);var v=e(".xubox_title").eq(r);var y=e(".xubox_main").eq(r);var C=e(".xubox_iframe").eq(r);var j=e(".xubox_loading").eq(r);var A=e(".xubox_botton").eq(r);var q=e(".xubox_close");if(z.v_offset[1].indexOf("px")!=-1){var x=g+parseInt(z.v_offset[1])}else{if(z.v_offset[1]=="50%"){var x=z.v_offset[1]}else{var x=g+parseInt(z.v_offset[1])/200*e(window).width()}}u.css({top:z.v_offset[0],left:x,width:z.v_area[0],height:z.v_area[1],"margin-left":-g});var p=A.length;if(p>0){switch(z.v_btns){case 0:A.html("").hide();break;case 2:A.html('<a href="javascript:;" class="xubox_yes xubox_botton2_'+z.v_skin+'">'+z.v_btn[0]+'</a><a href="javascript:;" class="xubox_no xubox_botton3_'+z.v_skin+'">'+z.v_btn[1]+"</a>");break;default:A.html('<a href="javascript:;" class="xubox_yes xubox_botton1_'+z.v_skin+'">'+z.v_btn[0]+'</a><a class="xubox_no" style="displa:none;"></a>')}}var l=e(".xubox_yes");var k=e(".xubox_no");var s={a:parseInt(u.css("padding-bottom")),b:parseInt(v.height()),c:parseInt(y.css("margin-right"))*2,d:parseInt(j.width()),e:parseInt(j.height()),f:parseInt(j.css("margin-right"))*2,g:z.v_showtime,h:"",k:parseInt(y.css("margin-right"))};if(z.v_box==0){u.css({"z-index":"19000002"})}if(z.v_box==1){autoHen=function(){_boxhen=e(z.v_dom).outerHeight()+v.outerHeight()+A.find("a").outerHeight()+parseInt(A.find("a").css("bottom"))+20;y.css({height:_boxhen})};e(".xubox_page").css({width:u.width()-2*s.k});if(u.css("height")=="0px"||u.css("height")=="auto"){autoHen()}if(z.v_istitle==true){e(".xubox_page").css({top:s.b+15})}else{e(".xubox_page").css({top:15})}}if(z.v_box==2){C.css({width:u.width()-2*s.k});z.v_istitle?C.height(u.height()-s.b):C.height(u.height());if(z.v_istitle==true){C.css({top:s.b+s.a})}else{C.css({top:s.a})}C.attr("src",z.v_src)}if(z.v_box==3){z.v_showclose=false;z.v_move=false;u.css({width:(s.d+s.f+s.c)});z.v_istitle?u.css({height:s.b+s.e+s.f}):u.css({height:s.e+s.f});if(z.v_istitle==true){e(".xubox_loading").css({top:s.b+s.a})}else{e(".xubox_loading").css({top:s.a})}}if(z.v_istitle==true){v.css({width:u.width()-2*s.k})}else{e(".xubox_title").eq(0).css({width:u.width()-2*s.k})}if(z.v_showtime!=0){function B(){z.v_showtime--;if(z.v_showtime==0){c=r;layer_close();clearInterval(s.h);z.v_showtime=s.g}}s.h=setInterval(B,1000)}z.v_move?v.css({cursor:"move"}):v.css({cursor:"auto"});z.v_istitle||v.remove().hide();z.v_showclose||q.remove().hide();z.v_istitle||q.attr("class","xubox_close xubox_close1_"+z.v_skin);function n(){var E={x:e(document).width(),y:e(document).height()};if(d){E={x:e(document).width(),x1:e(window).width(),y:e(document).height()};if(E.x>E.x1){E.x=E.x-22}}e("#xubox_shade").css({width:E.x,height:E.y})}n();e(window).resize(n);e(window).scroll(n);function w(){u.css({top:e(document).scrollTop()+m})}if(u.css("position")!="fixed"){var m=u.offset().top;w();e(window).scroll(w)}!z.v_move||v.attr("move","ok");var h={e:false,x:0,y:0,i:0};e(".xubox_title").mousedown(function(E){if(e(this).attr("move")=="ok"){h.e=true;h.i=e(this).index(".xubox_title");$mlayer=e(".xubox_layer").eq(h.i);h.x=E.pageX-parseInt($mlayer.position().left);h.y=E.pageY-parseInt($mlayer.position().top);e(document).mousemove(function(H){if(h.e){var G=H.pageX-h.x;if(u.css("position")=="fixed"){var F=H.pageY-h.y-e(window).scrollTop()}else{var F=H.pageY-h.y}$mlayer.css({left:G,top:F})}}).mouseup(function(){h.e=false})}});layer_close=function(){function E(){$close_page=e(".xubox_layer").eq(0).find(".xubox_page").find("*").eq(0);for(i=0;i<3;i++){$close_page.hide().unwrap();if(d){e(".xubox_layer").hide()}e(".xubox_title").remove().hide();e(".xubox_close").remove().hide();e(".xubox_botton").remove().hide()}}if(e(".xubox_layer").length==1){e("#xubox_shade").remove().hide()}if(r==0){if(z.v_box==1){E()}else{e(".xubox_layer").remove().hide()}}else{if(c<1){if(e(".xubox_iframe").length>0){e(".xubox_layer").remove().hide();e("#xubox_shade").remove().hide()}else{e(".xubox_layer").eq(1).remove().hide();E();e("#xubox_shade").remove().hide()}}else{e(".xubox_layer").eq(c).remove().hide()}}clearInterval(s.h)};z=e.extend({close:function(){c=e(this).parents(".xubox_layer").index(".xubox_layer");if(c<0){return false}layer_close()},yes:function(){c=e(this).parents(".xubox_layer").index(".xubox_layer");if(c<0){return false}if(c>0||r==0){layer_close()}},no:function(){c=e(this).parents(".xubox_layer").index(".xubox_layer");if(c<0){return false}if(c>0||r==0){layer_close()}}},z);e(".xubox_layer").each(function(E){e(this).find(".xubox_close").click(z.close);e(this).find(".xubox_yes").click(z.yes);e(this).find(".xubox_no").click(z.no)});if(d){e("#xubox_shade,.xubox_layer").ieselect();DD_belatedPNG.fix("#xubox_shade,.xubox_layer,.xubox_title,.xubox_title i,.xubox_msg,.xubox_close")}};e.fn.ieselect=(d?function(g){g=e.extend({top:"auto",left:"auto",width:"auto",height:"auto",opacity:true,src:"javascript:false;"},g);var h='<iframe class="ieselect" frameborder="0" tabindex="-1" src="'+g.src+'"style="display:block; position:absolute; z-index:-1;'+(g.opacity!==false?"filter:Alpha(Opacity='0');":"")+"top:"+(g.top=="auto"?"expression(((parseInt(this.parentNode.currentStyle.borderTopWidth)||0)*-1)+'px')":f(g.top))+";left:"+(g.left=="auto"?"expression(((parseInt(this.parentNode.currentStyle.borderLeftWidth)||0)*-1)+'px')":f(g.left))+";width:"+(g.width=="auto"?"expression(this.parentNode.offsetWidth+'px')":f(g.width))+";height:"+(g.height=="auto"?"expression(this.parentNode.offsetHeight+'px')":f(g.height))+';"/>';return this.each(function(){if(e(this).children("iframe.ieselect").length===0){this.insertBefore(document.createElement(h),this.firstChild)}})}:function(){return this});function f(g){return g&&g.constructor===Number?g+"px":g}layer_alert=function(h,g,k,j){e.layer({v_msg:h,yes:g,v_msgtype:k,v_title:j})};layer_confirm=function(h,g,k,j){e.layer({v_msg:h,yes:g,no:k,v_title:j,v_msgtype:4,v_btns:2})};layer_load=function(h,g){e.layer({v_showtime:h,v_shade:g,v_istitle:false,v_box:3})}})(jQuery);